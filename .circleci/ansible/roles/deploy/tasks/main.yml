---
- name: "send build atrifacts to remote"
  copy:
    src: ../../artifact.tar.gz
    dest: ~/artifact.tar.gz
    owner: { { user } }
    mode: "0644"

- name: "Extract build atrifacts"
  raw: (mkdir ~/backend && tar â€“xvzf ~/artifact.tar.gz -C ~/backend)
  args:
    executable: /bin/bash

- name: "install backend artifacts"
  npm:
    path: ~/backend
    production: true

- name: "start the app"
  raw: (cd ~/backend && pm2 stop default; pm2 start npm -- start)
  args:
    executable: /bin/bash
